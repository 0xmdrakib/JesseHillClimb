:root{
  --vvw: 100vw;
  --vvh: 100vh;
  --lvw: 100vw;
  --lvh: 100vh;
  --mini-scale: 1;
  --mini-ui-scale: 1;

  --safe-top:0px;
  --safe-bottom:0px;
  --safe-left:0px;
  --safe-right:0px;
  --sky:#cfe9ff;
  --sky2:#f6e7d9;
  --dirt:#7a4a22;
  --dirt2:#5e3417;
  --grass:#3dbb5f;
  --hud:#ffffff;
  --shadow:rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{height:100%; margin:0; overscroll-behavior:none; overflow-x:hidden;}
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
  background: linear-gradient(#f5fbff, #e9f6ff);
  color:#0b1725;
  overscroll-behavior:none;
}
body.miniBody{
  background: var(--sky);
}
a{color:inherit}
.main{
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:18px;
}
.mainMini{padding:0; justify-content:flex-start;}
.shell{
  width:min(980px, 100%);
  border-radius:18px;
  background: rgba(255,255,255,.75);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(0,0,0,.06);
  box-shadow: 0 20px 60px rgba(0,0,0,.14);
  overflow:hidden;
}
.shellMini{
  width:100%;
  min-height:100vh;
  border-radius:0;
  border:0;
  box-shadow:none;
  background: var(--sky);
}

/* Mini App: virtual landscape
   In portrait webviews we cannot reliably lock device orientation without fullscreen + user gesture.
   Instead, we rotate the *page* into a fixed landscape layout that fills the Mini App viewport.
   IMPORTANT: do NOT scale the container; scale only UI pieces (HUD/controls) and the render scale. */
.shellMini.miniVirtualLandscape{
  position: fixed;
  left: 0;
  top: var(--vvh);         /* matches the CSS-tricks rotate technique */
  width: var(--lvw);       /* portrait height -> landscape width */
  height: var(--lvh);      /* portrait width  -> landscape height */
  transform: rotate(-90deg);
  transform-origin: left top;
  min-height: 0;
  display: flex;
  flex-direction: column;
  background: var(--sky);
}

/* When rotated, avoid vh/dvh math inside; use flex instead. */
.shellMini.miniVirtualLandscape .stage{
  flex: 1;
  height: auto;
}

/* Scale only UI chrome (HUD + controls) on small phones */
.shellMini.miniVirtualLandscape .hud,
.shellMini.miniVirtualLandscape .controls{
  transform: scale(var(--mini-ui-scale));
  transform-origin: top left;
}

/* Scale header + driver selector as well (keeps desktop-like proportions in Mini App) */
.shellMini.miniVirtualLandscape .header{
  transform: scale(var(--mini-ui-scale));
  transform-origin: top left;
}
.shellMini.miniVirtualLandscape .driverBtn{
  transform: scale(var(--mini-ui-scale));
  transform-origin: top right;
}

/* Keep HUD compact on small screens */
.shellMini .hudCard{
  min-width: clamp(160px, 20vmin, 220px);
  padding: 8px 10px;
}

/* Prevent any accidental horizontal scrollbars */
.mainMini{overflow:hidden;}
.header{
  padding:14px 16px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
}
.headerMini{
  padding-top: calc(14px + var(--safe-top));
}
.title{
  font-weight:800;
  letter-spacing:.2px;
  font-size:20px;
}
.sub{
  font-size:12px;
  opacity:.75;
  margin-top:2px;
}
.pill{
  border-radius:999px;
  padding:10px 12px;
  background: rgba(255,255,255,.9);
  border: 1px solid rgba(0,0,0,.08);
  display:inline-flex;
  gap:10px;
  align-items:center;
}
.btn{
  appearance:none;
  border:0;
  cursor:pointer;
  border-radius:999px;
  padding:10px 14px;
  font-weight:700;
  background:#0b1725;
  color:white;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
}
.btn:active{transform: translateY(1px)}
.stage{
  position:relative;
  height: min(640px, 70vh);
  background: var(--sky);
  border-top:1px solid rgba(0,0,0,.08);
  touch-action: none;
}

.playfield{
  position:relative;
  width:100%;
  height:100%;
  overflow:hidden;
}

/* Portrait Mini App: render a landscape playfield inside the portrait viewport */
.stagePortrait{
  display:flex;
  justify-content:center;
  align-items:center;
  padding: 10px;
}
.stagePortrait .playfield{
  width: 100%;
  height: auto;
  aspect-ratio: 16 / 9;
  max-height: 100%;
  border-radius: 18px;
  background: var(--sky);
}
.stagePortrait canvas{ height: 100%; }
.shellMini .stage{
  /* Mini Apps: fill the usable viewport; dvh behaves better with mobile browser UI */
  height: calc(100dvh - 74px - var(--safe-top));
}
canvas{
  width:100%;
  height:100%;
  display:block;
}
.overlay{
  pointer-events:none;
  position:absolute;
  inset:0;
}
.hud{
  position:absolute;
  top: calc(12px + var(--safe-top));
  left: calc(12px + var(--safe-left));
  display:flex;
  flex-direction:column;
  align-items:flex-start;
  gap:10px;
  max-width: calc(100% - 24px - var(--safe-left) - var(--safe-right));
}
.hudRow{
  display:flex;
  align-items:center;
  gap:12px;
}
.hudCard{
  width: fit-content;
  pointer-events:none;
  background: rgba(255,255,255,.8);
  border: 1px solid rgba(0,0,0,.08);
  border-radius:14px;
  padding:10px 12px;
  box-shadow: 0 14px 30px rgba(0,0,0,.12);
  min-width: 220px;
}
.hudTop{
  display:flex;
  gap:10px;
  align-items:baseline;
  font-weight:900;
}
.bigNum{font-size:20px}
.small{font-size:12px; opacity:.75}
.fuelBar{
  height:14px;
  width: 190px;
  background: rgba(0,0,0,.1);
  border-radius:999px;
  overflow:hidden;
  border:1px solid rgba(0,0,0,.12);
  margin-top:8px;
}
.fuelFill{
  height:100%;
  background: linear-gradient(90deg, #ff3b30, #ffd60a);
}
.pause{
  pointer-events:auto;
  position:absolute;
  top: calc(12px + var(--safe-top));
  right: calc(12px + var(--safe-right));
  width:54px;
  height:54px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.85);
  box-shadow:0 16px 30px rgba(0,0,0,.12);
  cursor:pointer;
  display:grid;
  place-items:center;
  font-weight:900;
}
.pauseOn{
  background:#0b1725;
  color:white;
  border-color: rgba(0,0,0,.22);
}
.controls{
  position:absolute;
  left:0; right:0;
  bottom:12px;
  display:flex;
  justify-content:space-between;
  padding:0 12px;
  gap:12px;
  pointer-events:none;
}
.pedal{
  pointer-events:auto;
  width:min(240px, 40vw);
  height:118px;
  border-radius:18px;
  border:1px solid rgba(0,0,0,.18);
  background: linear-gradient(#f4f4f4, #cfcfcf);
  box-shadow: inset 0 10px 14px rgba(255,255,255,.8), 0 18px 40px rgba(0,0,0,.18);
  position:relative;
  overflow:hidden;
  cursor:pointer;
  user-select:none;
  touch-action:none;
  display:grid;
  place-items:center;
  font-weight:900;
  letter-spacing:.6px;
}
.pedal:active{transform: translateY(2px)}
.pedalLabel{
  position:absolute;
  bottom:14px;
  font-size:18px;
  opacity:.9;
}
.holes{
  position:absolute;
  inset:0;
  background:
    radial-gradient(circle at 20% 25%, rgba(0,0,0,.3) 0 10px, transparent 11px),
    radial-gradient(circle at 50% 25%, rgba(0,0,0,.3) 0 10px, transparent 11px),
    radial-gradient(circle at 80% 25%, rgba(0,0,0,.3) 0 10px, transparent 11px),
    radial-gradient(circle at 20% 55%, rgba(0,0,0,.3) 0 10px, transparent 11px),
    radial-gradient(circle at 50% 55%, rgba(0,0,0,.3) 0 10px, transparent 11px),
    radial-gradient(circle at 80% 55%, rgba(0,0,0,.3) 0 10px, transparent 11px);
  opacity:.35;
}
.gauges{
  position:absolute;
  bottom:16px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:18px;
  pointer-events:none;
}
.gauge{
  width:120px;
  height:120px;
  border-radius:999px;
  background: radial-gradient(circle at 35% 30%, #ffffff, #cfcfcf);
  border:2px solid rgba(0,0,0,.22);
  box-shadow:0 18px 35px rgba(0,0,0,.16);
  position:relative;
  overflow:hidden;
}
.gaugeInteract{
  pointer-events:auto;
  cursor:pointer;
  appearance:none;
  padding:0;
  color:inherit;
  display:block;
}
.gaugeInteract:active{transform: translateY(1px)}
.gaugeDisabled{
  opacity:.45;
  cursor:default;
}
.gaugeActive{
  outline: 3px solid rgba(255, 214, 10, .35);
}
.gaugeFace{
  position:absolute;
  inset:10px;
  border-radius:999px;
  background: radial-gradient(circle at 35% 30%, #f7f7f7, #bdbdbd);
  border:1px solid rgba(0,0,0,.18);
}
.needle{
  position:absolute;
  width:3px;
  height:48px;
  background:#c01515;
  left:50%;
  top:22px;
  transform-origin: bottom center;
  border-radius:3px;
  box-shadow:0 2px 6px rgba(0,0,0,.25);
  z-index:3;
}
.gaugeCap{
  position:absolute;
  width:14px;
  height:14px;
  background:#e6e6e6;
  border:2px solid rgba(0,0,0,.3);
  border-radius:999px;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%);
  z-index:4;
}
.gaugeLabel{
  position:absolute;
  bottom:8px;
  width:100%;
  text-align:center;
  font-weight:900;
  letter-spacing:.6px;
  color:#c01515;
  z-index:5;
}
.headPicker{
  pointer-events:auto;
  display:flex;
  gap:10px;
  align-items:center;
}
.headBtn{
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px 12px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.75);
  cursor:pointer;
  user-select:none;
  font-weight:800;
}
.headBtnActive{
  background: rgba(255,255,255,.95);
  outline: 3px solid rgba(78,209,61,.35);
}
.headImg{
  width:34px;
  height:34px;
  image-rendering: pixelated;
  border-radius:10px;
  background: rgba(0,0,0,.06);
  border:1px solid rgba(0,0,0,.08);
}
.centerHint{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  text-align:center;
  pointer-events:none;
  font-weight:900;
  text-shadow: 0 3px 0 rgba(255,255,255,.4);
}
.centerHint small{
  display:block;
  margin-top:6px;
  opacity:.75;
  font-weight:700;
}
.footer{
  padding:12px 16px;
  font-size:12px;
  opacity:.7;
  display:flex;
  justify-content:space-between;
  gap:10px;
}

/* --- Mini App polish additions --- */
.main{
  padding:
    calc(18px + var(--safe-top))
    calc(18px + var(--safe-right))
    calc(18px + var(--safe-bottom))
    calc(18px + var(--safe-left));
}

/* In Mini Apps, remove the outer "browser shell" padding for true full-bleed gameplay. */
.main.mainMini{
  padding:0;
  justify-content:flex-start;
}

.titleRow{
  display:flex;
  align-items:center;
  gap:12px;
}
.pillRow{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
}
.pillBtn{
  appearance:none;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.6);
  padding:8px 12px;
  border-radius:999px;
  font-weight:800;
  cursor:pointer;
}
.pillBtn:active{transform: translateY(1px)}
.pillBtnActive{
  background: #0b1725;
  color:white;
  border-color: rgba(0,0,0,.2);
}

.headerBtns{
  display:flex;
  gap:10px;
  align-items:center;
}

.actionBtn{
  appearance:none;
  cursor:pointer;
  border-radius:999px;
  height:48px;
  padding:0 16px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  font-weight:900;
  letter-spacing:.2px;
  user-select:none;
  border:0;
  background: transparent;
}
.actionBtn:active{transform: translateY(1px)}

.btnDark{
  background:#0b1725;
  color:white;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
  width:96px;
}

.btnPrimary{
  background: linear-gradient(90deg, #0b1725, #123057);
  color:white;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
  width:96px;
}

.pauseHeader{
  min-width:48px;
  width:48px;
  padding:0;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.82);
  color:#0b1725;
  box-shadow:0 10px 25px rgba(0,0,0,.10);
}
.pauseHeaderOn{
  background:#0b1725;
  color:white;
  border-color: rgba(0,0,0,.22);
}

.hud{
  top: calc(12px + var(--safe-top));
  left: calc(12px + var(--safe-left));
}
.controls{
  bottom: calc(12px + var(--safe-bottom));
}
.gauges{
  bottom: calc(16px + var(--safe-bottom));
}

.tag{
  font-size:12px;
  font-weight:800;
  opacity:.85;
}

.fuelLow .fuelFill{
  animation: fuelPulse 1.1s infinite;
}
@keyframes fuelPulse{
  0%,100%{filter:saturate(1); opacity:1}
  50%{filter:saturate(1.6); opacity:.85}
}

.toast{
  position:absolute;
  left:50%;
  top: calc(12px + var(--safe-top));
  transform: translateX(-50%);
  background: rgba(10,20,30,.86);
  color:white;
  padding:10px 14px;
  border-radius:999px;
  font-weight:900;
  letter-spacing:.2px;
  box-shadow: 0 18px 40px rgba(0,0,0,.25);
  pointer-events:none;
}

.endScreen{
  position:absolute;
  inset:0;
  display:grid;
  place-items:center;
  background: rgba(245,251,255,.55);
  backdrop-filter: blur(6px);
}
.endCard{
  width:min(420px, calc(100% - 24px));
  background: rgba(255,255,255,.9);
  border: 1px solid rgba(0,0,0,.1);
  border-radius:18px;
  box-shadow: 0 30px 80px rgba(0,0,0,.18);
  padding:18px 16px;
  text-align:center;
}
.endTitle{
  font-size:26px;
  font-weight:1000;
  letter-spacing:.4px;
}
.endSub{
  margin-top:8px;
  font-weight:800;
  opacity:.8;
}
.endBtns{
  margin-top:14px;
  display:flex;
  justify-content:center;
  gap:10px;
}

.pauseBtn{
  pointer-events:auto;
  align-self:flex-end;
  appearance:none;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.75);
  border-radius:999px;
  padding:10px 12px;
  font-weight:900;
  cursor:pointer;
}
.pauseBtnOn{
  background:#0b1725;
  color:white;
  border-color: rgba(0,0,0,.22);
}

.panel{
  padding:14px 16px 18px;
  border-top:1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.6);
}
.panelTitle{
  font-weight:1000;
  letter-spacing:.4px;
  margin-bottom:10px;
}

.miniNote{
  margin-top:10px;
  font-size:12px;
  font-weight:800;
  opacity:.72;
}

/* --- Driver selector (top-right) --- */
.driverBtn{
  pointer-events:auto;
  position:absolute;
  top: calc(12px + var(--safe-top));
  right: calc(12px + var(--safe-right));
  height:44px;
  padding:0 12px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.82);
  box-shadow:0 16px 30px rgba(0,0,0,.12);
  display:flex;
  align-items:center;
  gap:10px;
  cursor:pointer;
  user-select:none;
}
.driverBtn:active{transform: translateY(1px)}
.driverIcon{
  width:30px;
  height:30px;
  border-radius:10px;
  image-rendering: pixelated;
  background: rgba(0,0,0,.06);
  border:1px solid rgba(0,0,0,.08);
}
.driverLabel{
  font-weight:1000;
}

.driverBackdrop{
  pointer-events:auto;
  position:absolute;
  inset:0;
  background: rgba(245,251,255,.55);
  backdrop-filter: blur(6px);
  display:flex;
  justify-content:flex-end;
  align-items:flex-start;
  padding:
    calc(68px + var(--safe-top))
    calc(12px + var(--safe-right))
    calc(12px + var(--safe-bottom))
    calc(12px + var(--safe-left));
}
.driverCard{
  width:min(360px, calc(100% - 24px));
  background: rgba(255,255,255,.92);
  border: 1px solid rgba(0,0,0,.10);
  border-radius:18px;
  box-shadow: 0 30px 80px rgba(0,0,0,.18);
  padding:14px 14px 12px;
}
.driverCardTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:12px;
  margin-bottom:10px;
}
.driverTitle{
  font-weight:1000;
  letter-spacing:.4px;
}
.driverClose{
  appearance:none;
  width:38px;
  height:38px;
  border-radius:999px;
  border:1px solid rgba(0,0,0,.12);
  background: rgba(255,255,255,.75);
  cursor:pointer;
  font-weight:1000;
}
.driverClose:active{transform: translateY(1px)}


.brandLogo{
  width:30px;
  height:30px;
  border-radius:10px;
  border:1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.7);
  box-shadow: 0 10px 25px rgba(0,0,0,.10);
}

.iconBtn{
  appearance:none;
  cursor:pointer;
  width:52px;
  height:48px;
  border-radius:999px;
  display:inline-flex;
  align-items:center;
  justify-content:center;
  border:0;
  user-select:none;
}
.iconBtn:active{transform: translateY(1px)}
.iconBtnDark{
  background: linear-gradient(90deg, #0b1725, #123057);
  color:white;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
}
.iconBtnPrimary{
  background: linear-gradient(90deg, #0b1725, #123057);
  color:white;
  box-shadow: 0 10px 25px rgba(0,0,0,.15);
}

.driverChevron{
  display:inline-flex;
  margin-left:6px;
  opacity:.75;
}

/* Mini App: avoid a small unused strip on the right side in some webviews */
.shellMini{width:100%; max-width:100%; overflow-x:hidden;}
.mainMini{width:100%;}
.shellMini .stage{width:100%;}

/* Mini App layout tightening for phones */
.shellMini .hud{
  top: calc(12px + var(--safe-top));
  left: calc(12px + var(--safe-left));
  right: calc(12px + var(--safe-right));
}
.shellMini .controls{
  bottom: calc(12px + var(--safe-bottom));
  padding-left: calc(12px + var(--safe-left));
  padding-right: calc(12px + var(--safe-right));
}
.shellMini .gauges{
  bottom: calc(16px + var(--safe-bottom));
}

/* Phone-sized controls: shrink without breaking desktop */
@media (max-width: 520px){
  .shellMini .pedal{
    width: min(200px, 42vw);
    height: clamp(76px, 12vh, 104px);
    border-radius: 16px;
  }
  .shellMini .gauge{
    width: clamp(72px, 18vw, 104px);
    height: clamp(72px, 18vw, 104px);
  }
  .shellMini .gauges{ gap: clamp(10px, 3vw, 16px); }
  .shellMini .hudCard{
    transform: scale(.92);
    transform-origin: top left;
    min-width: 160px;
    padding: 8px 10px;
  }
  .shellMini .bigNum{ font-size: 18px; }
  .shellMini .fuelBar{ width: 160px; }
}



/* --- Game over snapshot + onchain actions --- */
.endShotWrap{
  margin-top:12px;
  border-radius:14px;
  overflow:hidden;
  border:1px solid rgba(0,0,0,.10);
  background: rgba(0,0,0,.04);
}
.endShot{display:block; width:100%; height:auto;}
.endShotPlaceholder{padding:28px 0; font-weight:900; opacity:.6;}

.endOnchain{
  margin-top:12px;
  padding:12px;
  border-radius:14px;
  border:1px solid rgba(0,0,0,.10);
  background: rgba(255,255,255,.65);
  text-align:left;
}
.endOnchainTitle{
  font-weight:1000;
  letter-spacing:.4px;
  font-size:12px;
  text-transform:uppercase;
  opacity:.75;
  margin-bottom:8px;
}
.endOnchainMeta{font-size:12px; font-weight:800; opacity:.85; display:flex; flex-direction:column; gap:4px;}
.endOnchainLine{line-height:1.25;}
.endOnchainWarn{color:#9b5d00; opacity:1;}
.endOnchainErr{color:#9a1a1a; opacity:1;}
.endOnchainOk{color:#0a5d2a; opacity:1;}
.endOnchainBtns{margin-top:10px; display:flex; gap:10px;}
.endOnchainBtns .actionBtn{flex:1; justify-content:center;}

/* When forcing landscape playfield inside portrait, tighten controls further */
.stagePortrait .pedal{ width: min(180px, 38vw); height: clamp(70px, 10vh, 92px); }
.stagePortrait .gauge{ width: clamp(64px, 14vw, 92px); height: clamp(64px, 14vw, 92px); }
.stagePortrait .gauges{ gap: clamp(8px, 2.5vw, 14px); }

/* Mini portrait: small helper prompt (optional landscape) */
.landscapePrompt{
  pointer-events:auto;
  position:absolute;
  left:50%;
  top: calc(10px + var(--safe-top));
  transform: translateX(-50%);
  z-index: 50;
}
.landscapePromptCard{
  display:flex;
  gap:10px;
  align-items:center;
  padding:10px 12px;
  border-radius: 999px;
  background: rgba(10,20,30,.68);
  color: white;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255,255,255,.16);
  box-shadow: 0 16px 30px rgba(0,0,0,.18);
}
.landscapePromptTitle{
  font-weight: 900;
  font-size: 12px;
  letter-spacing: .2px;
  opacity: .95;
}
.landscapeBtn{
  border:0;
  background: rgba(255,255,255,.92);
  color: rgba(10,20,30,.92);
  font-weight: 900;
  font-size: 12px;
  padding: 8px 10px;
  border-radius: 999px;
}
.landscapeErr{
  font-size: 11px;
  font-weight: 800;
  opacity: .9;
  max-width: 240px;
}
